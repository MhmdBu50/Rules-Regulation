@model dynamic
@using Microsoft.AspNetCore.Localization

@section Styles {
    <link rel="stylesheet" href="~/css/AdminPage.css">
    <link rel="stylesheet" href="~/css/_rtl_Styles.css">
    <link rel="stylesheet" href="~/css/AdminPageCustom.css">
}

@section Scripts {
    <script src="@Url.Content("~/js/card-animations.js")"></script>
    <script src="@Url.Content("https://cdn.jsdelivr.net/npm/fitty@2.3.6/dist/fitty.min.js")"></script>
    <script src="@Url.Content("https://cdn.jsdelivr.net/npm/chart.js")"></script>
    <script src="@Url.Content("~/js/StatisticsInAdmin.js")"></script>
    <script src="~/js/ShowDetailsTracking.js"></script>
    <script src="@Url.Content("~/js/AdminTable.js")"></script>
    <script src="@Url.Content("~/js/adminVisitChart.js")"></script>
    <script src="@Url.Content("~/js/adminPageValidation.js")"></script>
    <script src="@Url.Content("~/js/languageSwitcher.js")"></script>
}

@{
    var requestCulture = Context.Features.Get<IRequestCultureFeature>();
    var currentCulture = requestCulture?.RequestCulture.Culture.Name ?? "en-US";
    var isArabic = currentCulture == "ar-SA";

    // Document Type translation logic
    var displayDocumentType = Model?.DocumentType?.ToString() ?? "";
    if (isArabic && !string.IsNullOrEmpty(displayDocumentType))
    {
        switch (displayDocumentType)
        {
            case "Student guides & templates":
                displayDocumentType = "أدلة ونماذج الطلاب";
                break;
            case "Student rules & regulations":
                displayDocumentType = "قواعد وأنظمة الطلاب";
                break;
            case "Employees’ rules & regulations":
                displayDocumentType = "قواعد وأنظمة الموظفين";
                break;
            case "Academic rules & regulations":
                displayDocumentType = "قواعد وأنظمة أكاديمية";
                break;
        }
    }

    // Department translation logic
    var displayDepartment = Model?.Department?.ToString() ?? "";
    if (isArabic && !string.IsNullOrEmpty(displayDepartment))
    {
        switch (displayDepartment)
        {
            case "Reg and Admission":
                displayDepartment = "التسجيل والقبول";
                break;
            case "CCSIT":
                displayDepartment = "كلية علوم الحاسب وتقنية المعلومات";
                break;
            case "Communication and tech":
                displayDepartment = "الاتصالات والتقنية";
                break;
            case "Hospital":
                displayDepartment = "المستشفى";
                break;
            case "Library":
                displayDepartment = "المكتبة";
                break;
            case "Students Affairs":
                displayDepartment = "شؤون الطلاب";
                break;
            case "Preparetory":
                displayDepartment = "السنة التحضيرية";
                break;
            case "Academic Affairs":
                displayDepartment = "الشؤون الأكاديمية";
                break;
        }
    }
}

@if (Model != null)
{
    <div class="record-full-details">
        <form id="recordForm_@Model.Id" method="post" action="@Url.Action("UpdateRecord", "Admin")" onsubmit="return handleFormSubmit(event, @Model.Id)">
            @Html.AntiForgeryToken()
            <input type="hidden" name="recordId" value="@Model.Id" />
            
            <div class="row mb-2">
                <div class="col-lg-6 col-12 mb-3 mb-lg-0">
                    <div class="table-responsive">
                        <table class="table table-borderless mb-0">
                            <tr>
                                <td colspan="3">
                                    <!-- Regulation/ Manual name (English) -->
                                    <label class="form-label fw-bold translatable-label" data-translate-key="admin-table-form-regulation-name-label"></label>
                                    <textarea name="regulationName" class="form-control" rows="2" readonly disabled>@Model.RegulationName</textarea>
                                </td>
                            </tr>
                            <tr>
                                <td colspan="3">
                                    <! -- Brief Description (English) -->
                                    <label class="form-label fw-bold translatable-label" data-translate-key="admin-table-form-brief-description-label"></label>
                                    <textarea name="description" class="form-control" rows="4" readonly disabled>@Model.Description</textarea>
                                </td>
                            </tr>
                            <tr>
                                <td colspan="2">
                                    <!-- Approving Entity (English) -->
                                    <label class="form-label fw-bold translatable-label" data-translate-key="admin-table-form-approving-entity-label"></label>
                                    <input type="text" name="approvingEntity" class="form-control" value="@Model.ApprovingEntity" readonly disabled>
                                </td>
                            </tr>
                            <tr>
                                <td colspan="2">
                                    <label class="form-label fw-bold translatable-label" data-translate-key="admin-table-form-note-label"></label>
                                    <input type="text" name="notes" class="form-control mb-2" value="@Model.Notes" readonly disabled>
                                </td>
                            </tr>
                            <tr>
                                <td class="col-12 col-sm-4">
                                    <!-- Approving Date -->
                                    <label class="form-label fw-bold translatable-label" data-translate-key="admin-table-form-approving-date-label"></label>
                                    <input type="date" name="approvalDate" class="form-control mb-2" value="@Model.ApprovalDate" readonly disabled>
                                </td>
                                <td class="col-12 col-sm-4">
                                    <!-- Version Date -->
                                    <label class="form-label fw-bold translatable-label" data-translate-key="admin-table-form-version-date-label"></label>
                                    <input type="date" name="versionDate" class="form-control mb-2" value="@Model.VersionDate" readonly disabled>
                                </td>
                            </tr>
                            <tr>
                                <td colspan="2">
                                    <!-- Version Number -->
                                    <label class="form-label fw-bold translatable-label" data-translate-key="admin-table-form-version-number-label"></label>
                                    <input type="text" name="version" class="form-control mb-2" value="@Model.Version" readonly disabled
                                    title="Version number (numbers, dots, and commas only)" pattern="[0-9.,]*" inputmode="numeric"
                                    oninput="this.value = this.value.replace(/[^0-9.,]/g, '')"
                                    onkeypress="return (event.charCode >= 48 && event.charCode <= 57) || event.charCode === 46 || event.charCode === 44">
                                </td>
                            </tr>
                            <tr>
                                <td colspan="2">
                                    <!-- Responsible Department -->
                                    <label class="fw-bold translatable-label" data-translate-key="admin-table-form-responsible-department-label"></label>
                                    <select name="department" class="form-select" disabled>
                                        <option value="@Model.Department" selected>@displayDepartment</option>
                                        <option value="Reg and Admission">@(isArabic ? "التسجيل والقبول" : "Reg and Admission")</option>
                                        <option value="CCSIT">@(isArabic ? "كلية علوم الحاسب وتقنية المعلومات" : "CCSIT")</option>
                                        <option value="Communication and tech">@(isArabic ? "الاتصالات والتقنية" : "Communication and tech")</option>
                                        <option value="Hospital">@(isArabic ? "المستشفى" : "Hospital")</option>
                                        <option value="Library">@(isArabic ? "المكتبة" : "Library")</option>
                                        <option value="Students Affairs">@(isArabic ? "شؤون الطلاب" : "Students Affairs")</option>
                                        <option value="Preparetory">@(isArabic ? "السنة التحضيرية" : "Preparetory")</option>
                                        <option value="Academic Affairs">@(isArabic ? "الشؤون الأكاديمية" : "Academic Affairs")</option>
                                    </select>
                                </td>
                            </tr>
                        </table>
                    </div>
                </div>

                <div class="col-lg-6 col-12">
                    <div class="table-responsive">
                        <table class="table table-borderless mb-0">
                            <tr>
                                <td colspan="3">
                                    <!-- Regulation/ Manual name (Arabic) -->
                                    <label class="form-label fw-bold translatable-label" data-translate-key="admin-table-form-regulation-name-ar-label"></label>
                                    <textarea name="regulationNameAr" class="form-control" rows="2" dir="rtl" readonly disabled>@(Model.RegulationNameAr ?? "")</textarea>
                                </td>
                            </tr>
                            <tr>
                                <td colspan="3">
                                    <!-- Brief Description (Arabic) -->
                                    <label class="form-label fw-bold translatable-label" data-translate-key="admin-table-form-brief-description-ar-label"></label>
                                    <textarea name="descriptionAr" class="form-control" rows="4" dir="rtl" readonly disabled>@(Model.DescriptionAr ?? "")</textarea>
                                </td>
                            </tr>
                            <tr>
                                <td colspan="2">
                                    <!-- Approving Entity (Arabic) -->
                                    <label class="form-label fw-bold translatable-label" data-translate-key="admin-table-form-approving-entity-ar-label"></label>
                                    <input type="text" name="approvingEntityAr" class="form-control" dir="rtl" value="@(Model.ApprovingEntityAr ?? "")" readonly disabled>
                                </td>
                            </tr>
                            <tr>
                                <td colspan="2">
                                    <!-- Note (Arabic) -->
                                    <label class="form-label fw-bold translatable-label" data-translate-key="admin-table-form-note-ar-label"></label>
                                    <input type="text" name="notesAr" class="form-control mb-2" dir="rtl" value="@(Model.NotesAr ?? "")" readonly disabled>
                                </td>
                            </tr>
                            <tr>
                                <td colspan="2">
                                    <!-- Document Type -->
                                    <label class="form-label fw-bold translatable-label" data-translate-key="admin-table-form-document-type-label"></label>
                                    <select name="documentType" class="form-select mb-2" disabled>
                                        <option value="@Model.DocumentType" selected>@displayDocumentType</option>
                                        <option value="Student guides & templates" id="admin-chart-legend-student-guides3">@(isArabic ? "أدلة وقوالب الطلاب" : "Student guides & templates")</option>
                                        <option value="Student rules & regulations" id="admin-chart-legend-student-rules3">@(isArabic ? "قواعد وأنظمة الطلاب" : "Student rules & regulations")</option>
                                        <option value="Employees’ rules & regulations" id="admin-chart-legend-employment-rules3">@(isArabic ? "قواعد وأنظمة الموظفين" : "Employees’ rules & regulations")</option>
                                        <option value="Academic rules & regulations" id="admin-chart-legend-academic-rules3">@(isArabic ? "قواعد وأنظمة أكاديمية" : "Academic rules & regulations")</option>
                                    </select>
                                </td>
                            </tr>
                            <tr>
                                <td>
                                    <!-- Attach word file -->
                                    <label class="form-label fw-bold translatable-label" data-translate-key="admin-table-form-attach-word-label" dir="ltr"></label>
                                    @{
                                        var wordAttachment = ((IEnumerable<dynamic>)Model.Attachments)?.FirstOrDefault(a => a.FileType?.ToString()?.ToLower() == "word" || a.FileType?.ToString()?.ToLower() == "docx");
                                    }
                                    <div class="input-group mb-2" dir="ltr">
                                        <input type="text" class="form-control attachment-display" id="wordDisplay_@Model.Id"
                                        value="@(wordAttachment?.OriginalFileName ?? "")" readonly disabled>
                                        <input type="file" id="wordFile_@Model.Id" class="d-none" accept=".doc,.docx"
                                        onchange="handleFileSelection(@Model.Id, 'word', this)" disabled>
                                        <span class="input-group-text attachment-upload-btn" id="wordUploadBtn_@Model.Id"
                                        style="cursor: not-allowed; opacity: 0.6;" title="Click Edit to enable file upload">
                                            <i class="bi bi-paperclip">
                                                <img src="~/svgs/admin/upload-file.svg" alt="upload-file" />
                                            </i>
                                        </span>
                                    </div>
                                </td>
                                <td>
                                    <!-- Attach PDF file -->
                                    <label class="form-label fw-bold translatable-label" data-translate-key="admin-table-form-attach-pdf-label" dir="ltr"></label>
                                    @{
                                        var pdfAttachment = ((IEnumerable<dynamic>)Model.Attachments)?.FirstOrDefault(a => a.FileType?.ToString()?.ToLower() == "pdf");
                                    }
                                    <div class="input-group mb-2" dir="ltr">
                                        <input type="text" class="form-control attachment-display" id="pdfDisplay_@Model.Id"
                                        value="@(pdfAttachment?.OriginalFileName ?? "")" readonly disabled>
                                        <input type="file" id="pdfFile_@Model.Id" class="d-none" accept=".pdf"
                                        onchange="handleFileSelection(@Model.Id, 'pdf', this)" disabled>
                                        <span class="input-group-text attachment-upload-btn" id="pdfUploadBtn_@Model.Id"
                                        style="cursor: not-allowed; opacity: 0.6;" title="Click Edit to enable file upload">
                                            <i class="bi bi-paperclip">
                                                <img src="~/svgs/admin/upload-file.svg" alt="upload-file" />
                                            </i>
                                        </span>
                                    </div>
                                </td>
                            </tr>
                            <tr>
                                <td colspan="2">
                                    <!-- Page Number -->
                                    <label class="form-label fw-bold translatable-label" data-translate-key="admin-table-form-page-number-label"></label>
                                    @{
                                        string pageNumberValue = "";
                                        try
                                        {
                                            pageNumberValue = Model?.PageNumber?.ToString() ?? "2";
                                        }
                                        catch
                                        {
                                            pageNumberValue = "2"; // Default fallback
                                        }
                                    }
                                    <input type="number" name="pageNumber" class="form-control" min="1" max="999"
                                    value="@pageNumberValue" readonly disabled id="pageNumber_@(Model?.Id ?? "")"
                                    onchange="handlePageNumberChange(@(Model?.Id ?? ""), this.value)"
                                    title="Page number for PDF thumbnail generation"
                                    pattern="[0-9]*" inputmode="numeric" oninput="this.value = this.value.replace(/[^0-9]/g, '')"
                                    onkeypress="return event.charCode >= 48 && event.charCode <= 57">
                                </td>
                            </tr>
                        </table>
                    </div>
                </div>
            </div>

            <div class="row mt-4">
                <div class="col-12">
                    <!-- Responsible Department contact information: -->
                    <label class="form-label fw-bold translatable-label" data-translate-key="admin-table-form-responsible-contact-label"></label>
                    @if (Model.ContactInformation != null && ((IEnumerable<dynamic>)Model.ContactInformation).Any())
                    {
                        <div class="row">
                            @foreach (var contact in Model.ContactInformation)
                            {
                                <div class="col-12 col-md-12 col-lg-6 col-xl-4 mb-3">
                                    <div class="p-3 border rounded h-100">
                                        <div class="mb-2">
                                            <!-- Name (English) -->
                                            <label class="form-label mb-0 translatable-label" data-translate-key="admin-table-form-contact-name-en-label"></label>
                                            <input type="text" class="form-control contact-input" value="@contact.Name" readonly disabled>
                                        </div>
                                        <div class="mb-2">
                                            <!-- Name (Arabic) -->
                                            <label class="form-label mb-0 translatable-label" data-translate-key="admin-table-form-contact-name-ar-label"></label>
                                            <input type="text" class="form-control contact-input" dir="rtl" value="@(contact.NameAr ?? "")" readonly disabled>
                                        </div>
                                        @if (!string.IsNullOrEmpty(contact.Email?.ToString()))
                                        {
                                            <div class="mb-2">
                                                <!-- Email -->
                                                <label class="form-label mb-0 translatable-label" data-translate-key="admin-table-form-contact-email-label"></label>
                                                <input type="email" class="form-control contact-input" value="@contact.Email" readonly disabled>
                                            </div>
                                        }
                                        @if (!string.IsNullOrEmpty(contact.Telephone?.ToString()) || !string.IsNullOrEmpty(contact.Mobile?.ToString()))
                                        {
                                            <div class="mb-2">
                                                <div class="row">
                                                    @if (!string.IsNullOrEmpty(contact.Telephone?.ToString()))
                                                    {
                                                        <div class="col-6">
                                                            <!-- Telephone number -->
                                                            <label class="form-label mb-0 translatable-label" data-translate-key="admin-table-form-contact-telephone-label"></label>
                                                            <input type="text" class="form-control contact-input" value="@contact.Telephone" readonly disabled>
                                                        </div>
                                                    }
                                                    @if (!string.IsNullOrEmpty(contact.Mobile?.ToString()))
                                                    {
                                                        <div class="col-6">
                                                            <!-- Mobile number -->
                                                            <label class="form-label mb-0 translatable-label" data-translate-key="admin-table-form-contact-mobile-label"></label>
                                                            <input type="text" class="form-control contact-input" value="@contact.Mobile" readonly disabled>
                                                        </div>
                                                    }
                                                </div>
                                            </div>
                                        }
                                    </div>
                                </div>
                            }
                        </div>
                    }
                    else
                    {
                        <div class="mb-3">
                            <p class="text-muted translatable-label" data-translate-key="admin-table-form-no-contact-info"></p>
                        </div>
                    }
                </div>
            </div>

            <div class="row mt-3">
                <div class="col-12">
                    <div class="d-flex flex-wrap justify-content-end gap-2">
                        <!-- Delete, Edit, Save, and Cancel buttons -->
                        <button type="button" class="btn btn-danger translatable-label" data-translate-key="admin-table-delete-button" onclick="deleteRecord(@Model.Id)"></button>
                        <button type="button" class="btn btn-secondary edit-btn translatable-label" data-translate-key="admin-table-edit-button" onclick="toggleEditMode(@Model.Id)"></button>
                        <button type="submit" class="btn btn-success save-btn translatable-label" data-translate-key="admin-table-save-button" style="display: none;"></button>
                        <button type="button" class="btn btn-outline-secondary cancel-btn translatable-label" data-translate-key="admin-table-cancel-button" style="display: none;" onclick="cancelEdit(@Model.Id)"></button>
                    </div>
                </div>
            </div>
        </form>
    </div>
}
else
{
    <div class="alert alert-danger">
        <!-- Record details could not be loaded. -->
        <i class="fas fa-exclamation-triangle me-2"></i>
        
    </div>
}